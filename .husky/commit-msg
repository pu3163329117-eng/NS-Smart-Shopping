#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üìù Validating commit message..."

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Commit message pattern
PATTERN="^(feat|fix|docs|style|refactor|test|chore)(\(.+\))?: .+"

if ! echo "$COMMIT_MSG" | grep -qE "$PATTERN"; then
  echo "‚ùå Invalid commit message format!"
  echo ""
  echo "Commit message must follow the pattern:"
  echo "  <type>(<scope>): <description>"
  echo ""
  echo "Allowed types:"
  echo "  feat     - New feature"
  echo "  fix      - Bug fix"
  echo "  docs     - Documentation"
  echo "  style    - Code style changes"
  echo "  refactor - Code refactoring"
  echo "  test     - Test related"
  echo "  chore    - Build process or tooling"
  echo ""
  echo "Examples:"
  echo "  feat: add user authentication"
  echo "  fix(api): resolve null pointer exception"
  echo "  docs: update installation guide"
  echo ""
  echo "Your message:"
  echo "  $COMMIT_MSG"
  exit 1
fi

# Check message length
DESCRIPTION=$(echo "$COMMIT_MSG" | cut -d: -f2- | sed 's/^ //')
if [ ${#DESCRIPTION} -lt 10 ]; then
  echo "‚ùå Commit message description is too short (min 10 chars)"
  exit 1
fi

if [ ${#DESCRIPTION} -gt 100 ]; then
  echo "‚ùå Commit message description is too long (max 100 chars)"
  exit 1
fi

echo "‚úÖ Commit message validation passed!"