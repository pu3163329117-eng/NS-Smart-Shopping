# NS Smart Shopping 架构决策记录

> 记录重要的架构决策和设计理由

## ADR-001: 采用 Monorepo 架构

### 状态
已采纳 ✅

### 背景
项目包含多个相关但独立的服务：
1. 主全栈应用 (smart-ja-web)
2. 微服务后端 (smart-ja-backend)
3. 共享工具和配置

### 决策
采用 Monorepo 架构，使用 npm workspaces 管理。

### 理由
1. **代码共享**: 共享工具函数、类型定义、配置
2. **依赖管理**: 统一管理依赖版本
3. **开发体验**: 一键启动所有服务
4. **部署协调**: 确保服务版本一致性

### 影响
- 使用 `npm workspaces` 管理
- 根目录配置共享工具
- 子项目保持独立构建

---

## ADR-002: 前端技术栈选择

### 状态
已采纳 ✅

### 背景
需要现代化的前端框架，支持：
1. 优秀的开发体验
2. 良好的性能
3. 活跃的生态系统
4. 易于团队协作

### 决策
选择 **Vue 3 + Composition API + Vite + Tailwind CSS**。

### 理由
1. **Vue 3**: 渐进式框架，学习曲线平缓
2. **Composition API**: 更好的逻辑复用和类型推导
3. **Vite**: 极速的开发服务器和构建工具
4. **Tailwind CSS**: 实用优先的CSS框架，快速UI开发

### 替代方案考虑
- React: 生态系统更庞大，但学习曲线较陡
- Svelte: 编译时优化，但生态系统较小
- Angular: 企业级功能，但过于重量级

---

## ADR-003: 后端技术栈选择

### 状态
已采纳 ✅

### 背景
需要轻量级、高性能的后端框架：
1. 快速开发API
2. 良好的中间件支持
3. 易于部署和维护
4. 与前端技术栈协调

### 决策
选择 **Node.js + Express + Prisma**。

### 理由
1. **Node.js**: JavaScript全栈，减少上下文切换
2. **Express**: 轻量灵活，中间件生态丰富
3. **Prisma**: 类型安全的ORM，优秀的开发体验
4. **SQLite/PostgreSQL**: 根据环境自动切换

### 数据库选择
- 开发环境: SQLite (零配置，快速启动)
- 生产环境: PostgreSQL (功能完整，性能优秀)

---

## ADR-004: AI 集成架构

### 状态
已采纳 ✅

### 背景
项目核心是AI深度托管，需要：
1. 多AI代理协作
2. 流式响应支持
3. 记忆和上下文管理
4. 工具调用能力

### 决策
采用 **DeepSeek API + 自定义代理框架**。

### 架构设计
```
前端请求 → Express路由 → AI服务层 → DeepSeek API
      ↑          ↓              ↓
      └── 流式响应 ← 结果处理 ← API响应
```

### 代理系统
1. **Coordinator**: 协调总管，路由到具体代理
2. **Planner**: 商业规划师，市场分析
3. **Designer**: 产品设计师，创意设计
4. **SupplyChain**: 供应链专家，成本控制
5. **Sales**: 销售经理，营销推广
6. **CFO**: 财务总监，投资分析

---

## ADR-005: 部署架构

### 状态
已采纳 ✅

### 背景
需要支持多种部署环境：
1. 本地开发
2. 演示环境
3. 生产环境

### 决策
采用 **Docker容器化 + 平台即服务**。

### 部署策略
1. **开发环境**: Docker Compose
2. **演示环境**: Zeabur (全栈托管)
3. **生产环境**: Vercel (前端) + Railway (后端)

### 配置管理
- 环境变量统一管理
- 多环境配置文件
- 密钥安全存储

---

## ADR-006: 代码质量保障

### 状态
已采纳 ✅

### 背景
遵循"反重力"的"No Shit Code"哲学，需要：
1. 自动化代码检查
2. 统一的代码风格
3. 防止技术债务积累

### 决策
建立完整的代码质量工具链。

### 工具链
1. **ESLint**: 代码规范检查
2. **Prettier**: 代码自动格式化
3. **Husky**: Git钩子自动化
4. **lint-staged**: 提交前检查

### 规则制定
1. 单文件不超过300行
2. 函数不超过50行
3. 注释率不低于20%
4. 复杂度限制

---

## ADR-007: 项目文档策略

### 状态
已采纳 ✅

### 背景
需要完整的文档支持：
1. 新成员快速上手
2. 架构决策记录
3. API文档自动生成
4. 部署和维护指南

### 决策
采用分层文档体系。

### 文档结构
1. **开发文档**: 环境设置、开发指南
2. **架构文档**: 设计决策、技术规范
3. **API文档**: Swagger自动生成
4. **用户文档**: 产品使用指南

### 文档工具
- Markdown格式
- Swagger for API
- JSDoc for 代码注释
- 版本控制管理

---

## ADR-008: 团队协作模型

### 状态
已采纳 ✅

### 背景
需要高效的团队协作机制，避免：
1. 代码冲突
2. 知识孤岛
3. 质量不一致

### 决策
采用"漫威全栈"协作模型。

### 角色定义
1. **Tony (架构师)**: 技术决策，代码审查
2. **Friday (前端)**: 组件开发，UI实现
3. **Jarvis (后端)**: API开发，数据库设计
4. **Ultron (重构)**: 代码优化，技术债务

### 工作流程
1. 每日代码提交
2. 每周代码审查
3. 每月技术债务清理
4. 每季度架构评审

---

## ADR-009: 监控和运维

### 状态
已采纳 ✅

### 背景
需要确保系统稳定运行：
1. 错误及时发现
2. 性能监控
3. 用户行为分析

### 决策
建立多层次的监控体系。

### 监控策略
1. **应用层**: 错误日志、性能指标
2. **基础设施**: 服务器状态、资源使用
3. **业务层**: 用户行为、转化率

### 工具选择
- 自定义日志系统
- 简单心跳检测
- 基础性能监控
- 用户反馈收集

---

## ADR-010: 安全策略

### 状态
已采纳 ✅

### 背景
需要保护用户数据和系统安全：
1. 用户认证和授权
2. 数据加密
3. API安全
4. 部署安全

### 决策
实施多层次安全防护。

### 安全措施
1. **认证**: JWT令牌
2. **授权**: 基于角色的访问控制
3. **数据**: 传输加密，存储加密
4. **API**: 速率限制，输入验证

### 合规考虑
- 用户隐私保护
- 数据最小化原则
- 安全审计日志

---

## 决策记录模板

### 新决策记录
```
## ADR-XXX: [决策标题]

### 状态
[提议中/已采纳/已拒绝]

### 背景
[问题描述，决策上下文]

### 决策
[选择的方案]

### 理由
[为什么选择这个方案]

### 替代方案
[考虑过的其他方案]

### 影响
[对系统的影响]

### 相关决策
[相关的其他决策]
```

---

## 版本历史

| 版本 | 日期 | 修改说明 |
|------|------|----------|
| 1.0.0 | 2026-02-27 | 初始版本，记录核心架构决策 |

---

*本文档遵循"反重力"架构决策记录规范*
*维护者: OpenClaw*
